---
title: "Final Report"
author: "Yueting Luo"
date: "12/7/2017"
output: html_document
---



#1. Overiew and Motivation

A lot of changes are happening in our government, and while the major focus has been towards the executive branch, it should not be overlooked that congress is in charge of the majority of the laws we live by each day. With the current political climate, we feel the public deserves a more transparent insight into its daily activities. The 115th Legislative Session began in January 2017, and so far, has been a tumultuous journey; from healthcare to the environment, to tax reform to the bills that the media overlooks, major changes have ocurred and will continue to occur that could impact every U.S. resident.   

Our objective is to create resources to allow the public to better understand how congress works, and what they spend their time on. There are an overwhelming number of bills introduced during each legislative session (>6,000), and many Americans do not know what they contain, or who sponsors them. Given the public's distaste for the way media frames political discussions, it is becoming more important for individuals to understand the process and be given raw information to draw their own conclusions. Normally the media is focused on one or two bills, despite many being discussed concurrently. 

Specifically, we want to examine major factors that could contribute or hinder a bill's success, and try to make predictions for bill outcomes. This will include educating the public on the different outcomes a bill can have (there are several!). Additionally, we will evaluate the congressional network, to determine the connectivity degree of the legislators. Do some of them simply sit back as a passive participant? Who has bipartisan connections, and who remains within the boundaries of their own party?  Finally, we want to create clear, concise visuals so the public has an opportunity to explore the focus areas for a certain party, state, or legislator. *The resource will focus less on examining specific bills that actually get passed, and more about where legislators focus their time, and how. (not sure about this last sentence)*


#2. Related Work

The inspiration for this project came from several directions. It is virtually impossible to ignore the daily discussion of bills that are US news networks decide to focus on. After some discussion, it made us realize we do not really know a whole lot about the bills going through congress, other than the ones discussed on the internet or on TV. While the classic schoolhouse rock [video](https://youtu.be/tyeJ55o3El0) provides an overview of the bill process, and congress.gov allows you to examine bills individually, very few resources exist to allow the public to visualize trends overall. 



#3. Initial Questions

We had several initial questions that served as the basis for our exploration, and different techniques (discussed below) in order to approach our questions. 


 > What is the prevalence of bill topic, by: legislative session?	by legislator? by state?  
 > What is the probability that a  certain bill topic be voted on, or become a  law? Do significant trends even exist that can predict outcomes?
 > How does geography and region affect policy area and legislative subject focus areas?
 > How many bills do states generally sponsor each session? How does number and topic differ among legislators from the same state?
ï‚§	prevalence of bill topic in general; likelihood of a certain bill topic to be voted on; likelihood of a certain topic to become a law
 > Which legislators have similar interests? Which legislators work with each other, and cosponsor bills together? This will include a network analysis 


In general, we were not looking to really answer one big question (although both bill outcomes, network connectivity, and policy area focus were all explored), but rather creating tools that could be utilized to explore activities in congress and understand bills better. 

We discussed using the following methods and tools in our data analysis. While several of them evolved throughout the project, these helped serve as the basis of our project and provided direction in our exploration. 

###Data Visualization

We decided to utilize several different data visualization tools to analyze and present our data. Depending on the topic, different presentations were considered more appropriate. Initially, our visualizations were determined to include: geographic distributions, summary statistics and tables, heat maps, and word clouds. 

###Network Connectivity

We were interested in examining the network for members of legislation. We determined that connections were formed if any legislators cosponsored bills together; and the direction of the connection would be determined by who influence whom. (Presumably, if a certain senator sponsored a bill, and then 12 others cosponsored it, he/she influence the others to sign on.) The network visualization will allow the public to see the direction of influence, who is working across party lines, and which legislators work with others. 

### Bill Outcome Predictions

*Ordinal Regression*

Since certain bill outcomes are better than others (i.e. a bill that becomes a law is more successful than a bill that gets voted on and fails), ordinal regression is explored. In statistics, ordinal regression (also called "ordinal classification") is a type of regression analysis used for predicting an ordinal variable, i.e. a variable whose value exists on an arbitrary scale where only the relative ordering between different values is significant. However, proportional odds must hold in order for this to be utilized. 

*Multinomail Regression*

If ordinal regression assumptions do not hold, multinomial regression could also be explosed. Multinomial regression is used to describe data and to explain the relationship between one dependent nominal variable and one or more continuous-level(interval or ratio scale) independent variables.

#4. Data Source

What Data:
We are using congressional records from Congress.gov. They provide downloadable, bulk data with information on bills, timelines and voting records. https://github.com/usgpo/bill-status/blob/master/BILLSTATUS-XML_User_User-Guide.md. We may also utilize voting records (http://clerk.house.gov/legislative/legvotes.aspx) 


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Libraries
library(treemap)
library(highcharter)
library(DT)
library(networkD3)
library(heatmaply)
library(tidyverse)
library(flexdashboard)
library(viridisLite)
library(shiny)
library(xml2)
library(grDevices)
library(distances)
library(gridExtra)
library(ggplot2)
library(reshape2)
library(wordcloud2)
library(readxl)
# Theme to use for highcharts (from example htmlwidgets page)
thm <- 
  hc_theme(
    colors = c("#1a6ecc", "#434348", "#90ed7d"),
    chart = list(
      backgroundColor = "white",
      style = list(fontFamily = "Source Sans Pro")
    ),
    xAxis = list(
      gridLineWidth = 1
    )
  )

red <- "rgba(205, 77, 77, 0.7)"
green <- "rgba(77, 205, 77, 0.7)"
blue <- "rgba(77, 77, 205, 0.7)"
###############################
### Data read in/processing ###
###############################
# Senator nodes
nodes <- read.csv("./data/nodes_proc.csv") %>% 
  mutate(label = paste0(last_name, ", ", first_name, " (", party, "-", state, ")"))
# Cosponsorship edges
simp_edges <- read.csv("./data/simplified_edges.csv")
# For heatmap
subject_matrix <- nodes %>%
  select(bioguideId, label, party, in_113, in_114, in_115) %>%
  left_join(read_csv("./data/member_leg_subject_matrix.csv"))
# Bill data for maps etc
mapdata3 <- read_csv("./data/mapdata3.csv")
# For individual Senator page
senatordata <- mapdata3
senatordata$senator <- paste(senatordata$first_name,senatordata$last_name,sep=" ")
senatordata$image <- paste("https://www.congress.gov/img/member/", tolower(senatordata$bioguideId), ".jpg", sep="")
# List for dropdown on map page
policy_area_list <- mapdata3 %>% 
  arrange(policy_area) %>% 
  .$policy_area %>% 
  unique()
# Processing map data for map page
mapdata3 <- mapdata3 %>%
  group_by(session, state_name, state, policy_area) %>%
  summarise(total_submit = sum(n()))

#For the modeling Data
fittedprob=read_csv("data/fittedprob.csv")
stack<-read_excel("data/stack.xlsx")
```

#5. Exploratory Analysis

## 5.1 Progress of Bills

```{r}
colnames(stack)=c("Topic","Introduced into Senate","Reported","Failed in the Senate","Passed in the Senate","Passed in the House","Become a Law")
temp=melt(stack,id="Topic")
p=ggplot(temp, aes(variable, value,group=Topic,color=Topic,fill=Topic))+geom_area(position = "stack")+theme(legend.position = "bottom")
p
```

## 5.2 Rate of Become to Law break down by Topics or States

```{r}

```


#6. Final Analysis